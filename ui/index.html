<!-- 
Design and build by Cryptotwilight

=========================================================
 Light Bootstrap Dashboard - v2.0.1
=========================================================

 Product Page: https://www.creative-tim.com/product/light-bootstrap-dashboard
 Copyright 2019 Creative Tim (https://www.creative-tim.com)
 Licensed under MIT (https://github.com/creativetimofficial/light-bootstrap-dashboard/blob/master/LICENSE)

 Coded by Creative Tim

=========================================================

 The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.  -->
<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8" />
    <link rel="apple-touch-icon" sizes="76x76" href="assets/img/apple-icon.png">
    <link rel="icon" type="image/png" href="assets/img/favicon.ico">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>Figli - NFT sharing done differently</title>
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no' name='viewport' />
    <!--     Fonts and icons     -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200" rel="stylesheet" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" />
    <!-- CSS Files -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet" />
    <link href="assets/css/light-bootstrap-dashboard.css?v=2.0.0 " rel="stylesheet" />
    <!-- CSS Just for demo purpose, don't include it in your project -->
    <link href="assets/css/demo.css" rel="stylesheet" />

    <script src="https://unpkg.com/ipfs-http-client-lite/dist/index.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script src="https://cdn.ethers.io/lib/ethers-5.0.umd.min.js" type="text/javascript"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/ethjs@0.3.4/dist/ethjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>

</head>

<body>
    <div class="wrapper">
        <div class="sidebar" data-image="../assets/img/sidebar-5.jpg">
            <!--
        Tip 1: You can change the color of the sidebar using: data-color="purple | blue | green | orange | red"

        Tip 2: you can also add an image using data-image tag
    -->
            <div class="sidebar-wrapper">
                <div class="logo">
                    <a href="index.html" class="simple-text">
                        Figli
                    </a>
                </div>
                <ul class="nav">
                    <li class="nav-item active">
                        <a class="nav-link" href="index.html">
                            <i class="nc-icon nc-chart-pie-35"></i>
                            <p>Dashboard</p>
                        </a>
                    </li>
                    <li>
                        <a class="nav-link" href="pages/gallery.html">
                            <i class="nc-icon nc-album-2"></i>
                            <p>NFT Gallery</p>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="main-panel">
            <!-- Navbar -->
            <nav class="navbar navbar-expand-lg " color-on-scroll="500">
                <div class="container-fluid">

                    <a class="navbar-brand" href="#pablo"> Figli Image Factory </a>

                    <button href="" class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" aria-controls="navigation-index" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-bar burger-lines"></span>
                        <span class="navbar-toggler-bar burger-lines"></span>
                        <span class="navbar-toggler-bar burger-lines"></span>
                    </button>
                    <div class="collapse navbar-collapse justify-content-end" id="navigation">
                        <ul class="nav navbar-nav mr-auto">
                            <li class="nav-item">&nbsp;
                            </li>
                            <li class=" nav-item">&nbsp;<i class="nc-icon nc-credit-card"></i>&nbsp;<span id="show_wallet" class="text-muted"></span>
                            </li>
                            <li class="nav-item">
                            </li>
                        </ul>
                        <ul class="navbar-nav ml-auto">
                            <li class="nav-item">

                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="connect_web_3" href="#">
                                    <span class="no-icon">Connect Web 3</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>
            <!-- End Navbar -->
            <div class="content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card ">
                                <div class="card-header ">
                                    <h4 class="card-title">Take Photo</h4>
                                    <p class="card-category">Take a Photo with your device</p>
                                </div>
                                <div class="card-body ">
                                    <video id="video" class="img-responsive" autoplay></video>

                                    <div>
                                        <center>
                                            <table>
                                                <tr>
                                                    <td>
                                                        <center><button id="start-camera" class="btn btn-success"><i class="fa fa-camera"></i> Start Camera</button></center>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <center><button id="click-photo" class="btn btn-primary"><i class="fa fa-picture-o"></i> Click Photo</button></center>
                                                    </td>
                                                </tr>
                                            </table>
                                        </center>
                                    </div>
                                    <hr>
                                    <div class="stats">
                                        <i class="fa fa-clock-o"></i> <span id="photo_status_display_span"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card ">
                                <div class="card-header ">
                                    <h4 class="card-title">Your Photo</h4>
                                    <p class="card-category">Mint Your NFT!</p>
                                </div>
                                <div class="card-body ">
                                    <canvas id="canvas"></canvas>
                                </div>
                                <div class="card-footer ">
                                    <div class="legend">
                                        <center>
                                            <table>
                                                <tr>
                                                    <td><canvas id="canvas"></canvas></td>
                                                </tr>
                                                <tr>
                                                    <td><span id="mint_fee_display_span"></span></td>
                                                </tr>
                                                <tr>
                                                    <td><input type="text" id="mint_title_field" placeholder="enter mint title ..."></td>
                                                </tr>
                                                <tr>
                                                    <td><button id="mint_button" class="btn btn-success"><i class="fa fa-flash"></i> Mint NFT</button> </td>
                                                </tr>
                                                <tr>
                                                    <td><button id="bin_photo_button" class="btn btn-danger"><i class="fa fa-trash"></i> Bin Photo</button></td>
                                                </tr>
                                            </table>
                                        </center>
                                    </div>
                                    <hr>
                                    <div class="stats">
                                        <i class="fa fa-history"></i> <span id="mint_status_display_span"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card ">
                                <div class="card-header ">
                                    <h4 class="card-title">Your NFT</h4>
                                    <p class="card-category">Share and spread the happiness</p>
                                </div>
                                <div class="card-body ">
                                    <canvas id="nft_canvas"></canvas>
                                </div>
                                <div class="card-footer ">
                                    <div class="legend">
                                        <center>
                                            <table>
                                                <tr>
                                                    <td><input id="share_field" type="text" placeholder="enter frens address ... " </td>
                                                </tr>
                                                <tr>
                                                    <td><button id="share_button" class="btn btn-success"><i class="fa fa-share"></i> Share </button></td>
                                                </tr>
                                                <tr>
                                                    <td><button id="burn_button" class="btn btn-danger"><i class="fa fa-fire"></i> Burn NFT</button></td>
                                                </tr>
                                            </table>
                                        </center>
                                    </div>
                                    <hr>
                                    <div class="stats">
                                        <i class="fa fa-check"></i> <span id="nft_share_status_span"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card ">
                                <div class="card-header ">
                                    <h4 class="card-title">Your Stats</h4>
                                    <p class="card-category">Share and spread the happiness</p>
                                </div>
                                <div class="card-body ">
                                    <table>
                                        <tr>
                                            <td>Total Earnings on Figli:</td>
                                            <td><span id="total_earnings_on_figli"></span></td>
                                        </tr>
                                        <tr>
                                            <td>Total Withdrawals from Figli:</td>
                                            <td><span id="total_withdrawals_from_figli"></span></td>
                                        </tr>
                                        <tr>
                                            <td><button id="refresh_stats" type="button" class="btn btn-warning"><i class="fa fa-refresh"></i> Refresh</button></td><td><button id="withdraw_all" type="button" class="btn btn-danger"><i class="fa fa-eject"></i> Withdraw All</button></td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="card-footer ">
                                    <div class="legend">
                                        <center>
                                            
                                        </center>
                                    </div>
                                    <hr>
                                    <div class="stats">
                                        <i class="fa fa-info-circle"></i> <span id="withdrawal_status_span"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card  card-tasks">
                                <div class="card-header ">
                                    <h4 class="card-title">Incoming Shares</h4>
                                    <p class="card-category">Shares from frens</p>
                                </div>
                                <div class="card-body ">
                                    <div class="table-full-width">
                                        <table class="table">
                                            <tbody>
                                                <tr>
                                                    <td>
                                                        <img src="assets/img/apple-icon.png" />
                                                    </td>
                                                    <td>Sign contract for "What are conference organizers afraid of?"</td>
                                                    <td class="td-actions text-right">
                                                        <button type="button" rel="tooltip" title="Unlock Re-share" data-toggle="modal" data-target="#unlock_re_share_modal" class="btn btn-info btn-simple btn-link">
                                                            <i class="fa fa-lock"></i>                                                            
                                                        </button>
                                                        <button type="button" rel="tooltip" title="Re-share" data-toggle="modal" data-target="#re_share_modal" class="btn btn-danger btn-simple btn-link">
                                                            <i class="fa fa-share-alt-square"></i>
                                                        </button>
                                                        <button type="button" rel="tooltip" title="Re-mint" data-toggle="modal" data-target="#re_mint_modal" class="btn btn-success btn-simple btn-link">
                                                            <i class="fa fa-flash"></i><i class="fa fa-flash"></i> 
                                                        </button>
                                                        <button type="button" rel="tooltip" title="Trash" data-toggle="modal" data-target="#trash_modal" class="btn btn-danger btn-simple btn-link">
                                                            <i class="fa fa-trash"></i> 
                                                        </button>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <img src="assets/img/apple-icon.png" />
                                                    </td>
                                                    <td>Lines From Great Russian Literature? Or E-mails From My Boss?</td>
                                                    <td class="td-actions text-right">
                                                        <button type="button" rel="tooltip" title="Re-share Unlocked" class="btn btn-info btn-simple btn-link">
                                                            <i class="fa fa-unlock"></i>
                                                        </button>
                                                        <button type="button" rel="tooltip" title="Re-share" class="btn btn-success btn-simple btn-link">
                                                            <i class="fa fa-share-alt-square"></i>
                                                        </button>
                                                        <button type="button" rel="tooltip" title="Re-mint" class="btn btn-success btn-simple btn-link">
                                                            <i class="fa fa-flash"></i><i class="fa fa-flash"></i> 
                                                        </button>
                                                        <button type="button" rel="tooltip" title="Trash" class="btn btn-danger btn-simple btn-link">
                                                            <i class="fa fa-trash"></i> 
                                                        </button>
                                                    </td>
                                                </tr>

                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="card-footer ">
                                    <hr>
                                    <div class="stats">
                                        <i class="now-ui-icons loader_refresh spin"></i> Updated 3 minutes ago
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <footer class="footer">
                <div class="container-fluid">
                    <nav>
                        <ul class="footer-menu">
                            <li>
                                <a href="https://www.blockstarlogic.com">
                                    Block Star Logic
                                </a>
                            </li>
                        </ul>
                        <p class="copyright text-center">
                            Â©
                            <script>
                                document.write(new Date().getFullYear())
                            </script>
                            <a href="https://www.blockstarlogic.com">Figli</a>, NEAR NFTs done differently
                        </p>
                    </nav>
                </div>
            </footer>
            <!-- Mini Unlock Reshare Modal -->
            <div class="modal fade modal-mini modal-primary" id="unlock_re_share_modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header justify-content-center">
                            <div class="modal-profile">
                                <i class="nc-icon nc-lock-circle-open"></i>
                            </div>
                        </div>
                        <div class="modal-body text-center">
                            <p>Unlock Reshare Fee: <span id="unlock_re_share_fee_display"></span></p>
                            <input type="hidden" id="unlock_re_share_nft_id">
                        </div>
                        <div class="modal-footer">
                            <button id="unlock_reshare_button" type="button" class="btn btn-link btn-simple">Unlock</button>
                            <button type="button" class="btn btn-link btn-simple" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
            <!--  End Modal -->
            <!-- Mini Reshare Modal -->
            <div class="modal fade modal-mini modal-primary" id="re_share_modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header justify-content-center">
                            <div class="modal-profile">
                                <i class="nc-icon nc-send"></i>
                            </div>
                        </div>
                        <div class="modal-body text-center">
                            <p>Reshare with frens <input type="text" id="re_share_address_field" placeholder="enter frens Aurora address ... "> </p>
                            <input type="hidden" id="re_share_nft_id">
                        </div>
                        <div class="modal-footer">
                            <button id="reshare_button" type="button" class="btn btn-link btn-simple">Reshare</button>
                            <button type="button" class="btn btn-link btn-simple" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
            <!--  End Modal -->
            <!-- Mini Remint Modal -->
            <div class="modal fade modal-mini modal-primary" id="re_mint_modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header justify-content-center">
                            <div class="modal-profile">
                                <i class="nc-icon nc-refresh-02"></i>
                            </div>
                        </div>
                        <div class="modal-body text-center">
                            <p>Re Mint Fee: <span id="remint_fee_display_span"></span></p>
                            <p>NFT to Remint : <span id="remint_nft_display_span"></span></p>
                            <input type="hidden" id="re_mint_nft_id">
                        </div>
                        <div class="modal-footer">
                            <button id="re_mint_button" type="button" class="btn btn-link btn-simple">Remint</button>
                            <button type="button" class="btn btn-link btn-simple" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
            <!--  End Modal -->
            <!-- Mini Trash Modal -->
            <div class="modal fade modal-mini modal-primary" id="trash_modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header justify-content-center">
                            <div class="modal-profile">
                                <i class="nc-icon nc-simple-remove"></i>
                            </div>
                        </div>
                        <div class="modal-body text-center">
                            <p>Are you sure you wish to trash your re-share? ID: <span id="trash_nft_id_span"></span></p>
                            <input type="hidden" id="trash_nft_id">
                        </div>
                        <div class="modal-footer">
                            <button id="trash_button" type="button" class="btn btn-link btn-simple">Trash</button>
                            <button type="button" class="btn btn-link btn-simple" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
            <!--  End Modal -->
        </div>
    </div>


</body>
<!--   Core JS Files   -->
<script src="assets/js/core/jquery.3.2.1.min.js" type="text/javascript"></script>
<script src="assets/js/core/popper.min.js" type="text/javascript"></script>
<script src="assets/js/core/bootstrap.min.js" type="text/javascript"></script>
<!--  Plugin for Switches, full documentation here: http://www.jque.re/plugins/version3/bootstrap.switch/ -->
<script src="assets/js/plugins/bootstrap-switch.js"></script>
<!--  Google Maps Plugin    -->
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=YOUR_KEY_HERE"></script>
<!--  Chartist Plugin  -->
<script src="assets/js/plugins/chartist.min.js"></script>
<!--  Notifications Plugin    -->
<script src="assets/js/plugins/bootstrap-notify.js"></script>
<!-- Control Center for Light Bootstrap Dashboard: scripts for the example pages etc -->
<script src="assets/js/light-bootstrap-dashboard.js?v=2.0.0 " type="text/javascript"></script>
<!-- Light Bootstrap Dashboard DEMO methods, don't include it in your project! -->

<script>
    let cameraButton = document.querySelector("#start-camera");
    let video = document.querySelector("#video");
    let photoButton = document.querySelector("#click-photo");
    photoButton.disabled = true;
    photoButton.setAttribute("class", "btn btn-default");
    let canvas = document.querySelector("#canvas");
    var nftCanvas = ge("nft_canvas");
    var image;
    var cameraActive;
    var localstream;
    cameraButton.addEventListener('click', async function() {
        activateCamera();
    });

    var img = new Image(); 
    img.src = "assets/img/android-icon-144x144.png" ;
    nftCanvas.getContext('2d').drawImage(img, 0,0, canvas.width, canvas.height);

    function activateCamera() {
        if (!cameraActive) {
            navigator.mediaDevices.getUserMedia({
                    video: true,
                    audio: false
                })
                .then(function(stream) {
                    localstream = stream;
                    video.srcObject = localstream;
                    cameraButton.innerHTML = "<i class=\"fa fa-camera\"></i> Stop Camera";
                    cameraButton.setAttribute("class", "btn btn-danger");
                    cameraActive = true;
                    photoButton.disabled = false;
                    photoButton.setAttribute("class", "btn btn-success");
                })
                .catch(function(err) {
                    console.log(err);
                })
        } else {
            video.pause();
            video.src = "";
            localstream.getTracks()[0].stop();
            cameraButton.innerHTML = "<i class=\"fa fa-camera\"></i> Start Camera";
            cameraButton.setAttribute("class", "btn btn-success");
            cameraActive = false;
            photoButton.disabled = true;
            photoButton.setAttribute("class", "btn btn-default");
        }
    }

    photoButton.addEventListener('click', function() {
        canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
        let image_data_url = canvas.toDataURL('image/jpeg');
        image = image_data_url;

        // data url of the image
        console.log(image);
    });

    function ge(element) {
        return document.getElementById(element);
    }
</script>

<script src="abi/iFigliAbi.js"></script>
<script>
    const onboardButton = ge("connect_web_3");
    const showWallet = ge("show_wallet");
    var account;


    const binButton = ge("bin_photo_button");
    binButton.addEventListener('click', deleteImage);

    function deleteImage() {
        clearMint();
    }

    const mintTitleField = ge("mint_title_field");
    const mintButton = ge("mint_button");
    mintButton.addEventListener('click', mint);
    const mintStatusDisplaySpan = ge("mint_status_display_span");



    function mint() {

        ipfs.add(image)
            .then(function(response) {
                console.log(response);
                var ipfsHash = "" + response[0].hash;
                figliContract.methods.getMintFee().call({
                        from: account
                    })
                    .then(function(response) {
                        console.log(response);
                        var fee = response;
                        var title = mintTitleField.value;
                        figliContract.methods.mint(ipfsHash, title, fee).send({
                                from: account,
                                value: fee
                            })
                            .then(function(response) {
                                console.log(response);
                                mintStatusDisplaySpan.innerHTML = "NEAR Hash :: " + response.nearTransactionHash;
                                console.log("loading image ... ");
                               
                            })
                            .catch(function(err) {
                                console.log(err);
                            })
                    })
                    .catch(function(err) {
                        console.log(err);
                    })
            })
            .catch(function(err) {
                console.log(err);
            })

    }
    const unlockReshareFeeDisplay = ge("unlock_reshare_fee_display");

    const unlockReShareButton = ge("unlock_reshare_button");
    const unlockReShareNFTId = ge("unlock_re_share_nft_id");
    unlockReShareButton.addEventListener("click", unlockReshare);

    function setUnlockReshareModal(nftId){
        unlockReShareNFTId.value = nftId; 
    }

    function unlockReshare() { 
        var nftId = unlockReShareNFTId.value;
        ifigliContract.methods.getUnlockReShareFee().call({from : account})
        .then(function(response){
            console.log(response);
            var fee = response; 
            figliContract.methods.unlockReshare(nftId, fee).send({from : account})
            .then(function(response){
                console.log(response);
            })
            .catch(function(err){
                console.log(err);
            });
        })
        .catch(function(err){
            console.log(err);
        });
    }
    const reshareUserAddress = ge("re_share_address_field");
    const reshareNFTId = ge("re_share_nft_id");
    const reshareButton = ge("reshare_button");
    reshareButton.addEventListener("click", reShare);

    function setReshareModal(nftId) {
        reshareNFTId.value = nftId; 
    }

    function reShare() { 
        var user = reshareUserAddress.value; 
        var nftId = reshareNFTId.value;
        figliContract.methods.reshare(user, nftId).send({from : account})
        .then(function(response){
            console.log(response);
        })
        .catch(function(err){
            console.log(err);
        });
    }

    const reMintNFTId = ge("re_mint_nft_id");
    const reMintButton = ge("re_mint_button");
    const reMintFeeDisplaySpan = ge("remint_fee_display_span");
    const reMintNFTDisplaySpan = ge("remint_nft_display_span");
    reMintButton.addEventListener("click", remint);

    function setRemintModal(nftId){
        reMintNFTId.value = nftId; 
        figliContract.methods.getRemintFee().call({from : account})
        .then(function(response){
            console.log(response);
            reMintFeeDisplaySpan.innerHTML = response; 
        })
        .catch(function(err){
            console.log(err);
        });
    }

    function remint(){
        var nftId = reMintNFTId.value;
        ifigliContract.methods.getRemintFee().call({from : account})
        .then(function(response){
            console.log(response);
            var fee = response; 
            figliContract.methods.remint(nftId, fee).send({from : account})
            .then(function(response){
                console.log(response);
            })
            .catch(function(err){
                console.log(err);
            });
        })
        .catch(function(err){
            console.log(err);
        });
    }

    const trashNFTId = ge("trash_nft_id");
    const trashButton = ge("trash_button");
    const trashNFTIdSpan = ge("trash_nft_id_span");
    trashButton.addEventListener("click", trash); 

    function setTrashModal(nftId){
        trashNFTId.value = nftId; 
        trashNFTIdSpan.innerHTML = nftId; 
    }

    function trash() { 
        var nftId;
        figliContract.methods.trash(nftId).send({from : account})
        .then(function(response){
            console.log(response);
        })
        .catch(function(err){
            console.log(err);
        });
    }

    const totalEarningsOnFigliSpan = ge("total_earnings_on_figli");
    const totalWithdrawalsFromFigli = ge("total_withdrawals_from_figli");

    const refreshStats = ge("refresh_stats");
    refreshStats.addEventListener("click", loadStats);

    function loadStats() { 
        figliContract.methods.getTotalEarnings().call({from : account})
        .then(function(response){
            console.log(response);
            totalEarningsOnFigliSpan.innerHTML = response; 
        })
        .catch(function(err){
            console.log(err);
        });

        figliContract.methods.getTotalWithdrawnEarnings().call({from : account})
        .then(function(response){
            console.log(response);
            totalWithdrawalsFromFigli.innerHTML = response;

        })
        .catch(function(err){
            console.log(err);
        });
    }

    const web3 = new Web3(window.ethereum);

    const ipfs = window.IpfsHttpClientLite('https://ipfs.infura.io:5001');
    const buffer = window.IpfsHttpClientLite.Buffer;
    console.log("got ipfs: " + ipfs);

    const figliAddress = "0xF28Ccae4ae06ABD2e34A35b764F2E0DAA6f561c5";
    const figliContract = new web3.eth.Contract(iFigliAbi, figliAddress);

    //Created check function to see if the MetaMask extension is installed
    const isMetaMaskInstalled = () => {

        const {
            ethereum
        } = window;
        return Boolean(ethereum && ethereum.isMetaMask);
    };

    const MetaMaskClientCheck = () => {
        //Now we check to see if Metmask is installed
        if (!isMetaMaskInstalled()) {
            console.log("metamask not installed");
            //If it isn't installed we ask the user to click to install it
            onboardButton.innerText = 'Click here to install MetaMask!';
            //When the button is clicked we call this function
            onboardButton.onclick = onClickInstall;
            //The button is now disabled
            onboardButton.disabled = false;
        } else {
            //If it is installed we change our button text
            onboardButton.innerText = 'Click to Connect Metamask';

            console.log("metamask installed");
            onboardButton.addEventListener('click', () => {
                getAccount();
                onboardButton.innerText = "Web 3 Connected";
                loadStats();
            });
        }
    };
    const initialize = () => {
        MetaMaskClientCheck();
    };

    window.addEventListener('DOMContentLoaded', initialize);

    async function getAccount() {
        const accounts = await ethereum.request({
            method: 'eth_requestAccounts'
        });
        account = accounts[0];
        showWallet.innerHTML = " :: " + account;
    }

    //We create a new MetaMask onboarding object to use in our app
    //const onboarding = new MetaMaskOnboarding({ forwarderOrigin });

    //This will start the onboarding proccess
    const onClickInstall = () => {
        onboardButton.innerText = 'Onboarding in progress';
        onboardButton.disabled = true;
        //On this object we have startOnboarding which will start the onboarding process for our end user
        onboarding.startOnboarding();
    };

    const onClickConnect = async() => {
        try {
            // Will open the MetaMask UI
            // You should disable this button while the request is pending!
            await ethereum.request({
                method: 'eth_requestAccounts'
            });
        } catch (error) {
            console.error(error);
        }
    };

    function clearMint() {
        image = "";
        const context = canvas.getContext('2d');
        context.clearRect(0, 0, canvas.width, canvas.height);
        mintTitleField.value = "";
    }

    function ge(element) {
        return document.getElementById(element);
    }
</script>

</html>